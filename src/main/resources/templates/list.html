<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::content}, 'All Posts - Brainstorm')}">
<body>
<div th:fragment="content" class="scrollable">
    <div class="posts-header">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="page-title mb-2">All Posts</h1>
                <p class="post-meta" th:text="${#lists.size(posts)} + ' ' + (${#lists.size(posts)} == 1 ? 'post' : 'posts')">0 posts</p>
            </div>
            <a th:href="@{/add}" class="btn btn-success">
                <i class="fas fa-plus me-2"></i>Write
            </a>
        </div>

        <!-- Search Bar -->
        <form method="get" action="/posts" class="search-bar">
            <i class="fas fa-search search-icon"></i>
            <input 
                type="text" 
                name="search" 
                class="form-control" 
                placeholder="Search by title, content, or date (YYYY-MM-DD)..." 
                th:value="${search}"
                autocomplete="off">
            <button type="submit" class="btn btn-primary search-button" title="Search">
                <i class="fas fa-search"></i>
            </button>
            <button type="button" class="clear-search" onclick="clearSearch()" title="Clear search" th:if="${search != null && search != ''}">
                <i class="fas fa-times"></i>
            </button>
        </form>

        <div th:if="${search != null && search != ''}" class="search-results-text">
            <span th:if="${#lists.size(posts) > 0}">
                Found <strong th:text="${#lists.size(posts)}">0</strong> result(s) for "<strong th:text="${search}"></strong>"
            </span>
            <span th:if="${#lists.isEmpty(posts)}">
                No results found for "<strong th:text="${search}"></strong>"
            </span>
        </div>

        <div class="divider"></div>
    </div>

    <div class="posts-scroll-container">
        <div th:if="${#lists.isEmpty(posts) && (search == null || search == '')}" class="empty-state">
            <i class="fas fa-feather-alt"></i>
            <h3>No posts yet</h3>
            <p>Start writing your first post to begin your journey.</p>
            <a th:href="@{/add}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Create Your First Post
            </a>
        </div>

        <div th:if="${#lists.isEmpty(posts) && search != null && search != ''}" class="empty-state">
            <i class="fas fa-search"></i>
            <h3>No matches found</h3>
            <p>Try adjusting your search terms or <a href="/posts">view all posts</a>.</p>
        </div>

        <div th:if="${!#lists.isEmpty(posts)}">
            <article class="card" th:each="post : ${posts}">
                <div class="card-body">
                    <h2 class="post-title">
                        <a th:href="@{/{id}(id=${post.id})}" th:text="${post.subject}">Post Title</a>
                    </h2>
                    <div class="post-date mb-3">
                        <i class="far fa-calendar me-1"></i>
                        <span th:text="${#temporals.format(#temporals.createDate(#strings.substring(post.date, 0, 4) + '-' + #strings.substring(post.date, 5, 7) + '-' + #strings.substring(post.date, 8, 10)), 'MMMM d, yyyy')}">Date</span>
                    </div>
                    <div th:if="${#strings.length(post.content) > 0}" class="post-excerpt">
                        <span th:text="${#strings.length(post.content) > 200 ? #strings.substring(post.content, 0, 200) + '...' : post.content}"></span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <a th:href="@{/{id}(id=${post.id})}" class="text-decoration-none">
                            Read more â†’
                        </a>
                        <div>
                            <a th:href="@{/edit/{id}(id=${post.id})}" class="btn btn-sm btn-outline-secondary me-2">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </div>

    <script>
        function clearSearch() {
            window.location.href = '/posts';
        }
    </script>
</div>
</body>
</html>
